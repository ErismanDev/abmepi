{% extends 'base.html' %}
{% load static %}

{% block title %}Teste de Erros no Modal - ASEJUS{% endblock %}

{% block extra_css %}
<style>
    .form-control.is-invalid,
    .form-select.is-invalid {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
        background-color: #fff5f5 !important;
    }
    
    .form-group.has-error .form-label {
        color: #dc3545 !important;
        font-weight: bold !important;
    }
    
    .invalid-feedback {
        display: block !important;
        color: #dc3545 !important;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .invalid-feedback i {
        color: #dc3545;
    }
    
    .alert-danger {
        border-left: 4px solid #dc3545;
    }
    
    .alert-danger .alert-heading {
        color: #721c24;
    }
    
    .is-invalid {
        animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
    
    .error-summary {
        background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
        border: 1px solid #feb2b2;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4><i class="fas fa-bug me-2"></i>Teste de Exibição de Erros no Modal</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        Este teste demonstra como os erros de validação aparecem no modal de advogados.
                        Clique nos botões abaixo para ver diferentes cenários de erro.
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Testes de Erro</h5>
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-warning" onclick="testValidationErrors()">
                                    <i class="fas fa-exclamation-triangle me-2"></i>Testar Erros de Validação
                                </button>
                                <button type="button" class="btn btn-danger" onclick="testSystemErrors()">
                                    <i class="fas fa-times-circle me-2"></i>Testar Erros do Sistema
                                </button>
                                <button type="button" class="btn btn-info" onclick="testMixedErrors()">
                                    <i class="fas fa-random me-2"></i>Testar Erros Mistos
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5>Status</h5>
                            <div id="statusArea">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Clique em um dos testes para ver os erros no modal
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Teste -->
<div class="modal fade" id="testModal" tabindex="-1" aria-labelledby="testModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="testModalLabel">
                    <i class="fas fa-user-tie me-2"></i>Teste de Erros - Modal Advogado
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="testModalBody">
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-3 text-muted">Modal de teste carregado...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
                <button type="button" class="btn btn-primary" onclick="submitTestForm()">
                    <i class="fas fa-save me-2"></i>Salvar
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Função para atualizar status
    function updateStatus(message, type = 'info') {
        const statusDiv = document.getElementById('statusArea');
        const alertClass = type === 'error' ? 'alert-danger' : 
                         type === 'success' ? 'alert-success' : 
                         type === 'warning' ? 'alert-warning' : 'alert-info';
        
        statusDiv.innerHTML = `<div class="alert ${alertClass}">
            <i class="fas fa-${type === 'error' ? 'times-circle' : 
                               type === 'success' ? 'check-circle' : 
                               type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
            ${message}
        </div>`;
    }

    // Teste 1: Erros de Validação
    function testValidationErrors() {
        updateStatus('Testando erros de validação...', 'warning');
        
        const modalBody = document.getElementById('testModalBody');
        modalBody.innerHTML = `
            <!-- Resumo de Erros -->
            <div class="alert alert-danger border-danger mb-4">
                <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle fa-2x me-3 text-danger"></i>
                    <div>
                        <h5 class="alert-heading mb-2">
                            <i class="fas fa-times-circle me-2"></i>Formulário com Erros de Validação
                        </h5>
                        <p class="mb-2">Foram encontrados 5 erro(s) no formulário.</p>
                        <p class="mb-0 small text-muted">Por favor, corrija os campos destacados em vermelho e tente novamente.</p>
                    </div>
                </div>
            </div>
            
            <!-- Informações sobre campos obrigatórios -->
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Campos obrigatórios:</strong> Nome, CPF, OAB, UF OAB, E-mail, Telefone, Endereço, Cidade, Estado, CEP, Data de Inscrição OAB, Anos de Experiência e Situação.
            </div>
            
            <!-- Formulário com Erros -->
            <form id="testForm">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group has-error mb-3">
                            <label for="nome" class="form-label text-danger fw-bold">
                                Nome <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control is-invalid" id="nome" name="nome" value="">
                            <div class="invalid-feedback d-block text-danger mt-1">
                                <div><i class="fas fa-times-circle me-1"></i>Nome é obrigatório.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group has-error mb-3">
                            <label for="cpf" class="form-label text-danger fw-bold">
                                CPF <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control is-invalid" id="cpf" name="cpf" value="">
                            <div class="invalid-feedback d-block text-danger mt-1">
                                <div><i class="fas fa-times-circle me-1"></i>CPF é obrigatório.</div>
                                <div><i class="fas fa-times-circle me-1"></i>CPF deve ter 11 dígitos.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        `;
        
        // Abrir modal
        const modal = new bootstrap.Modal(document.getElementById('testModal'));
        modal.show();
        
        updateStatus('Erros de validação exibidos no modal!', 'success');
    }

    // Teste 2: Erros do Sistema
    function testSystemErrors() {
        updateStatus('Testando erros do sistema...', 'warning');
        
        const modalBody = document.getElementById('testModalBody');
        modalBody.innerHTML = `
            <div class="alert alert-danger border-danger">
                <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle fa-2x me-3 text-danger"></i>
                    <div>
                        <h5 class="alert-heading mb-2">
                            <i class="fas fa-times-circle me-2"></i>Erro no Sistema
                        </h5>
                        <p class="mb-2">Erro ao processar solicitação: Falha na conexão com o banco de dados</p>
                        <hr class="my-3">
                        <h6 class="mb-2">Detalhes do Erro:</h6>
                        <ul class="mb-0 small">
                            <li><strong>database:</strong> Connection timeout</li>
                            <li><strong>system:</strong> Database server unreachable</li>
                            <li><strong>timestamp:</strong> ${new Date().toLocaleString()}</li>
                        </ul>
                    </div>
                </div>
            </div>
        `;
        
        // Abrir modal
        const modal = new bootstrap.Modal(document.getElementById('testModal'));
        modal.show();
        
        updateStatus('Erro do sistema exibido no modal!', 'success');
    }

    // Teste 3: Erros Mistos
    function testMixedErrors() {
        updateStatus('Testando erros mistos...', 'warning');
        
        const modalBody = document.getElementById('testModalBody');
        modalBody.innerHTML = `
            <!-- Resumo de Erros -->
            <div class="error-summary">
                <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle fa-2x me-3 text-danger"></i>
                    <div>
                        <h5 class="mb-2">
                            <i class="fas fa-times-circle me-2"></i>Formulário com Múltiplos Tipos de Erro
                        </h5>
                        <p class="mb-2">Foram encontrados 3 erro(s) de validação e 1 erro(s) do sistema.</p>
                        <p class="mb-0 small text-muted">Alguns campos têm problemas de validação e há um erro de conexão.</p>
                    </div>
                </div>
            </div>
        `;
        
        // Abrir modal
        const modal = new bootstrap.Modal(document.getElementById('testModal'));
        modal.show();
        
        updateStatus('Erros mistos exibidos no modal!', 'success');
    }

    function submitTestForm() {
        updateStatus('Formulário enviado! (Simulação)', 'success');
    }

    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        updateStatus('Sistema de teste de erros carregado!', 'success');
    });
</script>
{% endblock %}
