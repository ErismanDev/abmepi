<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Decorator AJAX</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .test-container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 20px;
        }
        
        .test-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .log-container {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            font-size: 11px;
        }
        
        .status-indicator {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-info { background: #d1ecf1; color: #0c5460; }
        .status-warning { background: #fff3cd; color: #856404; }
        
        .debug-info {
            background: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .test-button {
            margin: 5px;
        }
        
        .response-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 11px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-center mb-4">
            <i class="fas fa-cogs text-primary"></i>
            Teste Decorator AJAX
        </h1>
        
        <div class="test-section">
            <h4><i class="fas fa-info-circle text-info"></i> Status do Sistema</h4>
            <div id="systemStatus" class="status-indicator status-info">
                Inicializando sistema...
            </div>
            
            <div class="row mt-3">
                <div class="col-md-3">
                    <button type="button" class="btn btn-primary w-100 test-button" onclick="testBasicGET()">
                        <i class="fas fa-globe me-2"></i>GET B√°sico
                    </button>
                </div>
                <div class="col-md-3">
                    <button type="button" class="btn btn-success w-100 test-button" onclick="testAJAXGET()">
                        <i class="fas fa-network-wired me-2"></i>GET AJAX
                    </button>
                </div>
                <div class="col-md-3">
                    <button type="button" class="btn btn-warning w-100 test-button" onclick="testAJAXPOST()">
                        <i class="fas fa-paper-plane me-2"></i>POST AJAX
                    </button>
                </div>
                <div class="col-md-3">
                    <button type="button" class="btn btn-info w-100 test-button" onclick="testAllCombinations()">
                        <i class="fas fa-cogs me-2"></i>Todos
                    </button>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h4><i class="fas fa-terminal text-warning"></i> Log de Atividades</h4>
            <div id="logContainer" class="log-container">
                <div class="text-muted">Aguardando a√ß√µes...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h4><i class="fas fa-code text-secondary"></i> Informa√ß√µes de Debug</h4>
            <div id="debugInfo" class="debug-info">
                <div class="text-muted">Informa√ß√µes de debug aparecer√£o aqui...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h4><i class="fas fa-file-code text-primary"></i> Preview da Resposta</h4>
            <div id="responsePreview" class="response-preview">
                <div class="text-muted">Conte√∫do da resposta aparecer√° aqui...</div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script de teste -->
    <script>
        let logCount = 0;
        
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> ${message}`;
            
            if (type === 'error') {
                logEntry.className = 'text-danger';
            } else if (type === 'success') {
                logEntry.className = 'text-success';
            } else if (type === 'warning') {
                logEntry.className = 'text-warning';
            }
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            logCount++;
            
            // Limitar logs
            if (logCount > 200) {
                logContainer.removeChild(logContainer.firstChild);
                logCount--;
            }
        }
        
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('systemStatus');
            statusEl.textContent = message;
            statusEl.className = `status-indicator status-${type}`;
        }
        
        function updateDebugInfo(info) {
            const debugEl = document.getElementById('debugInfo');
            debugEl.innerHTML = `<pre>${JSON.stringify(info, null, 2)}</pre>`;
        }
        
        function updateResponsePreview(content, contentType, status) {
            const previewEl = document.getElementById('responsePreview');
            previewEl.innerHTML = `
                <div class="mb-2">
                    <strong>Status:</strong> <span class="badge bg-${status >= 200 && status < 300 ? 'success' : 'warning'}">${status}</span>
                    <strong>Content-Type:</strong> <span class="badge bg-info">${contentType || 'N/A'}</span>
                </div>
                <div class="mb-2">
                    <strong>Conte√∫do (primeiros 500 chars):</strong>
                </div>
                <div style="background: #fff; padding: 10px; border-radius: 3px; border: 1px solid #ccc;">
                    <pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">${content.substring(0, 500)}</pre>
                </div>
            `;
        }
        
        async function testBasicGET() {
            addLog('üåê Testando GET b√°sico (sem headers AJAX)...', 'info');
            updateStatus('Testando GET b√°sico...', 'info');
            
            const url = '/assejus/advogados/modal/novo/';
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    credentials: 'same-origin'
                });
                
                const contentType = response.headers.get('content-type');
                const text = await response.text();
                
                addLog(`üì• GET b√°sico: ${response.status} - ${contentType}`, 'info');
                
                if (contentType && contentType.includes('application/json')) {
                    addLog('‚úÖ Resposta JSON recebida', 'success');
                } else {
                    addLog('‚ö†Ô∏è Resposta n√£o √© JSON', 'warning');
                }
                
                updateResponsePreview(text, contentType, response.status);
                updateDebugInfo({
                    test_type: 'basic_get',
                    response_status: response.status,
                    content_type: contentType,
                    content_preview: text.substring(0, 200)
                });
                
            } catch (error) {
                addLog(`‚ùå Erro no GET b√°sico: ${error.message}`, 'error');
                updateStatus('‚ùå Erro no teste!', 'error');
            }
        }
        
        async function testAJAXGET() {
            addLog('üåê Testando GET com headers AJAX...', 'info');
            updateStatus('Testando GET AJAX...', 'info');
            
            const url = '/assejus/advogados/modal/novo/';
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    credentials: 'same-origin'
                });
                
                const contentType = response.headers.get('content-type');
                const text = await response.text();
                
                addLog(`üì• GET AJAX: ${response.status} - ${contentType}`, 'info');
                
                if (contentType && contentType.includes('application/json')) {
                    addLog('‚úÖ Resposta JSON recebida', 'success');
                } else {
                    addLog('‚ö†Ô∏è Resposta n√£o √© JSON', 'warning');
                }
                
                updateResponsePreview(text, contentType, response.status);
                updateDebugInfo({
                    test_type: 'ajax_get',
                    response_status: response.status,
                    content_type: contentType,
                    content_preview: text.substring(0, 200)
                });
                
            } catch (error) {
                addLog(`‚ùå Erro no GET AJAX: ${error.message}`, 'error');
                updateStatus('‚ùå Erro no teste!', 'error');
            }
        }
        
        async function testAJAXPOST() {
            addLog('üì§ Testando POST com headers AJAX...', 'info');
            updateStatus('Testando POST AJAX...', 'info');
            
            const url = '/assejus/advogados/modal/novo/';
            const formData = new FormData();
            formData.append('test', 'true');
            formData.append('nome', 'Teste AJAX');
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json'
                    },
                    credentials: 'same-origin'
                });
                
                const contentType = response.headers.get('content-type');
                const text = await response.text();
                
                addLog(`üì• POST AJAX: ${response.status} - ${contentType}`, 'info');
                
                if (contentType && contentType.includes('application/json')) {
                    addLog('‚úÖ Resposta JSON recebida', 'success');
                } else {
                    addLog('‚ö†Ô∏è Resposta n√£o √© JSON', 'warning');
                }
                
                updateResponsePreview(text, contentType, response.status);
                updateDebugInfo({
                    test_type: 'ajax_post',
                    response_status: response.status,
                    content_type: contentType,
                    content_preview: text.substring(0, 200)
                });
                
            } catch (error) {
                addLog(`‚ùå Erro no POST AJAX: ${error.message}`, 'error');
                updateStatus('‚ùå Erro no teste!', 'error');
            }
        }
        
        async function testAllCombinations() {
            addLog('üîß Testando todas as combina√ß√µes de headers...', 'info');
            updateStatus('Testando todas as combina√ß√µes...', 'info');
            
            const url = '/assejus/advogados/modal/novo/';
            const combinations = [
                {
                    name: 'Sem headers',
                    headers: {}
                },
                {
                    name: 'Apenas X-Requested-With',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                },
                {
                    name: 'Apenas Accept',
                    headers: {
                        'Accept': 'application/json'
                    }
                },
                {
                    name: 'X-Requested-With + Accept',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json'
                    }
                },
                {
                    name: 'X-Requested-With + Accept + Content-Type',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                },
                {
                    name: 'Accept espec√≠fico',
                    headers: {
                        'Accept': 'application/json, text/plain, */*'
                    }
                }
            ];
            
            for (const combo of combinations) {
                addLog(`üß™ Testando: ${combo.name}`, 'info');
                
                try {
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: combo.headers,
                        credentials: 'same-origin'
                    });
                    
                    const contentType = response.headers.get('content-type');
                    const isJson = contentType && contentType.includes('application/json');
                    
                    addLog(`  üì• ${response.status} - ${isJson ? '‚úÖ JSON' : '‚ùå N√£o-JSON'} - ${contentType}`, isJson ? 'success' : 'warning');
                    
                    if (isJson) {
                        const data = await response.json();
                        addLog(`  üìã Sucesso: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
                    } else {
                        const text = await response.text();
                        addLog(`  üìÑ Conte√∫do: ${text.substring(0, 100)}...`, 'warning');
                    }
                    
                } catch (error) {
                    addLog(`  ‚ùå Erro: ${error.message}`, 'error');
                }
                
                // Aguardar um pouco entre as requisi√ß√µes
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            updateStatus('‚úÖ Teste de todas as combina√ß√µes conclu√≠do!', 'success');
        }
        
        // Verificar status inicial
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ P√°gina carregada, pronta para testes...', 'info');
            updateStatus('Sistema pronto para testes', 'success');
        });
    </script>
</body>
</html>
